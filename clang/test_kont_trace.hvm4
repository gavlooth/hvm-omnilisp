// Test continuation invocation tracing

// Minimal test: check if k(42) reduces properly
@test_kont_invoke = λ&k. !!&res = (k(42)); res

@test1 = @test_kont_invoke(λ&x. x)  // Should be 42
@test2 = @test_kont_invoke(λ&x. (x + 1))  // Should be 43

// Test with wrapped continuation
@unwrap_kont = λ&kont. λ&arg.
  λ{
    #Kont: λ&k. (k(arg))
    _: λ&u_. 0
  }(kont)

@test3 = @unwrap_kont(#Kont{λ&x. x})(42)

// Test nested continuation - like Add with perform
@test_add_cont =
  (λ&va.
    @unwrap_kont(#Kont{λ&vb. (va + vb)})(42)
  )(1)

@test4 = @test_add_cont

@main = #CON{@test1, #CON{@test2, #CON{@test3, #CON{@test4, #NIL}}}}
