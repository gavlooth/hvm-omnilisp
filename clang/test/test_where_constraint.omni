;; test_where_constraint.omni - Tests for typed function parameters

;; OmniLisp uses {Type} syntax in slots for type annotations

;; TEST: basic typed function
;; EXPECT: 15
(do
  (define add-nums [x {Int}] [y {Int}]
    (+ x y))
  (add-nums 7 8))

;; TEST: typed with string
;; EXPECT: "Hello, world"
(do
  (define greet [name {String}]
    (str-concat "Hello, " name))
  (greet "world"))

;; TEST: max value function
;; EXPECT: 10
(do
  (define max-val [x] [y]
    (if (> x y) x y))
  (max-val 5 10))

;; TEST: max of equal values
;; EXPECT: 7
(do
  (define max-val [x] [y]
    (if (> x y) x y))
  (max-val 7 7))

;; TEST: function composition
;; EXPECT: 8
(do
  (define double [x] (* x 2))
  (define inc [x] (+ x 1))
  (double (inc 3)))

;; TEST: nested typed call
;; EXPECT: 22
(do
  (define add-nums [x {Int}] [y {Int}] (+ x y))
  (define max-val [x] [y] (if (> x y) x y))
  (define double [x] (* x 2))
  (add-nums (max-val 10 5) (double 6)))

;; TEST: identity function
;; EXPECT: 42
(do
  (define id [x] x)
  (id 42))

;; TEST: typed function equals
;; EXPECT: true
(do
  (define add-nums [x {Int}] [y {Int}] (+ x y))
  (= (add-nums 20 22) 42))
