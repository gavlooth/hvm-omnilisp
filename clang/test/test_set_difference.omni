;; test_set_difference.lisp - Tests for set difference

;; Set difference returns elements in s1 but not in s2
(define set-difference-helper [s2] [keys] [result]
  (match keys
    ()       result
    (k .. rest)
      (if (dict-has? s2 k)
        (set-difference-helper s2 rest result)
        (set-difference-helper s2 rest (dict-set result k true)))))

(define set-difference [s1] [s2]
  (set-difference-helper s2 (dict-keys s1) #{}))

;; TEST: difference with overlap
;; EXPECT: #{1 true}
(set-difference #{1 2 3} #{2 3 4})

;; TEST: difference disjoint sets
;; EXPECT: #{1 true 2 true}
(set-difference #{1 2} #{3 4})

;; TEST: difference removes all
;; EXPECT: #{}
(set-difference #{1 2} #{1 2 3 4})

;; TEST: difference with empty s2
;; EXPECT: #{1 true 2 true 3 true}
(set-difference #{1 2 3} #{})

;; TEST: difference with empty s1
;; EXPECT: #{}
(set-difference #{} #{1 2 3})

;; TEST: difference with self
;; EXPECT: #{}
(set-difference #{1 2 3} #{1 2 3})

;; TEST: difference with symbols
;; EXPECT: #{:a true}
(set-difference #{:a :b :c} #{:b :c :d})

;; Symmetric difference (elements in either but not both)
(define set-symmetric-difference [s1] [s2]
  (set-union (set-difference s1 s2) (set-difference s2 s1)))

;; TEST: symmetric difference
;; EXPECT: #{1 true 4 true}
(set-symmetric-difference #{1 2 3} #{2 3 4})
