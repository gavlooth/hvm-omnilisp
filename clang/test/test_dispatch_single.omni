;; test_dispatch_single.lisp - Tests for single dispatch

;; Single dispatch on first argument type
(defgfun render [element])

(defmethod render [element {Text}]
  (str-concat "<p>" (get element :content) "</p>"))

(defmethod render [element {Image}]
  (str-concat "<img src=\"" (get element :src) "\"/>"))

(defmethod render [element {Link}]
  (str-concat "<a href=\"" (get element :href) "\">" (get element :text) "</a>"))

;; TEST: render text
;; EXPECT: "<p>Hello</p>"
(render #{"type" "text" "content" "Hello"})

;; TEST: render image
;; EXPECT: "<img src=\"pic.jpg\"/>"
(render #{"type" "image" "src" "pic.jpg"})

;; TEST: render link
;; EXPECT: "<a href=\"/home\">Home</a>"
(render #{"type" "link" "href" "/home" "text" "Home"})

;; Dispatch by predicate
(defgfun classify [n])

(defmethod classify [n] & (< n 0)
  "negative")

(defmethod classify [n] & (= n 0)
  "zero")

(defmethod classify [n] & (> n 0)
  "positive")

;; TEST: classify negative
;; EXPECT: "negative"
(classify -5)

;; TEST: classify zero
;; EXPECT: "zero"
(classify 0)

;; TEST: classify positive
;; EXPECT: "positive"
(classify 10)
