;; test_grammar_neg.lisp - Tests for grammar negation/not-predicate

;; Pika supports negative lookahead (not predicate)
;; TEST: not followed by
;; EXPECT: ("a" nil)
(pika-parse
  (grammar
    [S (seq A (not B))]
    [A "a"]
    [B "b"])
  "ac")

;; TEST: not predicate doesn't consume
;; EXPECT: ("ab" nil)
(pika-parse
  (grammar
    [S (seq (not "x") "ab")]
    )
  "ab")

;; TEST: not at end
;; EXPECT: nil
(pika-parse
  (grammar
    [S (seq "hello" (not "!"))])
  "hello!")

;; TEST: not with class
;; EXPECT: ("a" nil)
(pika-parse
  (grammar
    [S (seq (not (class "0-9")) (class "a-z"))])
  "a1")

;; TEST: double not (positive lookahead)
;; EXPECT: ("ab" nil)
(pika-parse
  (grammar
    [S (seq (not (not "a")) "ab")])
  "ab")

;; TEST: not in alternation
;; EXPECT: ("x" nil)
(pika-parse
  (grammar
    [S (alt (seq (not "a") any) "a")])
  "x")

;; TEST: not with repetition
;; EXPECT: ("bbb" nil)
(pika-parse
  (grammar
    [S (rep1 (seq (not "a") "b"))])
  "bbb")

;; TEST: end of input check
;; EXPECT: ("hello" nil)
(pika-parse
  (grammar
    [S (seq word (not any))]
    [word (rep1 (class "a-z"))])
  "hello")
