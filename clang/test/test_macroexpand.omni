;; test_macroexpand.omni - Tests for macroexpand

;; Define test macros
(define [syntax double]
  [(double ?x) (* ?x 2)])

(define [syntax square]
  [(square ?x) (* ?x ?x)])

(define [syntax quad]
  [(quad ?x) (double (double ?x))])

;; TEST: macroexpand simple
;; EXPECT: (* x 2)
(macroexpand '(double x))

;; TEST: macroexpand with value
;; EXPECT: (* 5 2)
(macroexpand '(double 5))

;; TEST: macroexpand square
;; EXPECT: (* x x)
(macroexpand '(square x))

;; TEST: macroexpand one level only
;; EXPECT: (double (double x))
(macroexpand '(quad x))

;; Macroexpand preserves non-macros
;; TEST: macroexpand non-macro
;; EXPECT: (+ 1 2)
(macroexpand '(+ 1 2))

;; TEST: macroexpand literal
;; EXPECT: 42
(macroexpand 42)

;; TEST: macroexpand quote
;; EXPECT: 'hello
(macroexpand ''hello)

;; Macroexpand-1 is alias
;; TEST: macroexpand-1
;; EXPECT: (* x 2)
(macroexpand-1 '(double x))

;; Quote prevents expansion
;; TEST: quoted form not expanded
;; EXPECT: (double x)
(macroexpand ''(double x))

;; TEST: macroexpand let
;; EXPECT: (let [x 5] (* x 2))
(macroexpand '(let [x 5] (double x)))
