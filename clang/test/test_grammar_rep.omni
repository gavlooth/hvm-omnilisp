;; test_grammar_rep.lisp - Tests for repetition combinators

;; Zero-or-more (*)
;; TEST: zero-or-more with matches
;; EXPECT: ("a" "a" "a")
(defgrammar as
  (zero-or-more (lit "a")))
(parse as "aaa")

;; TEST: zero-or-more empty
;; EXPECT: ()
(parse as "bbb")

;; TEST: zero-or-more partial
;; EXPECT: ("a" "a")
(parse as "aab")

;; One-or-more (+)
;; TEST: one-or-more with matches
;; EXPECT: ("a" "a" "a")
(defgrammar as-plus
  (one-or-more (lit "a")))
(parse as-plus "aaa")

;; TEST: one-or-more fail empty
;; EXPECT: nil
(parse as-plus "bbb")

;; TEST: one-or-more single
;; EXPECT: ("a")
(parse as-plus "ab")

;; Optional (?)
;; TEST: optional present
;; EXPECT: "a"
(defgrammar maybe-a
  (optional (lit "a")))
(parse maybe-a "a")

;; TEST: optional absent
;; EXPECT: nil
(parse maybe-a "b")

;; Exact repetition {n}
;; TEST: exactly n times
;; EXPECT: ("a" "a" "a")
(defgrammar three-as
  (repeat-n 3 (lit "a")))
(parse three-as "aaa")

;; TEST: exactly n fail short
;; EXPECT: nil
(parse three-as "aa")

;; Range repetition {n,m}
;; TEST: range repetition
;; EXPECT: ("a" "a")
(defgrammar two-to-four-as
  (repeat-range 2 4 (lit "a")))
(parse two-to-four-as "aa")

;; TEST: range max
;; EXPECT: ("a" "a" "a" "a")
(parse two-to-four-as "aaaaa")

;; TEST: range fail
;; EXPECT: nil
(parse two-to-four-as "a")
