;; test_effects_writer.omni - Tests for Writer effect pattern
;; Writer effect accumulates output (logs)

;; TEST: single tell - numeric
;; EXPECT: 1
(handle
  (do
    (perform tell 999)
    1)
  (tell [msg resume] (resume msg)))

;; TEST: multiple tells - numeric
;; EXPECT: 999
(handle
  (do
    (perform tell 1)
    (perform tell 2)
    (perform tell 3)
    999)
  (tell [msg resume] (resume msg)))

;; TEST: log and compute
;; EXPECT: 30
(do
  (define log-compute [x]
    (handle
      (let [doubled (* x 2)]
        (do
          (perform log-msg 0)
          (+ doubled 10)))
      (log-msg [msg resume] (resume msg))))
  (log-compute 10))

;; TEST: log with value
;; EXPECT: 42
(handle
  (let [x (perform get-val nil)]
    (do
      (perform tell-val x)
      x))
  (get-val [_ resume] (resume 42))
  (tell-val [msg resume] (resume msg)))

;; Trace effect for debugging
;; TEST: trace calls - numeric
;; EXPECT: 100
(handle
  (do
    (perform trace 1)
    (perform trace 2)
    100)
  (trace [msg resume] (resume msg)))

;; EXPECT: true
(handle
  (do
    (if true
      (perform log 1)
      (perform log 0))
    true)
  (log [msg resume] (resume msg)))
