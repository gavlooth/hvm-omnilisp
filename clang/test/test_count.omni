;; test_count.omni - Tests for count functions

;; Helper definitions used by tests
(define count-if [pred] [lst]
  (length (filter pred lst)))

(define count [val] [lst]
  (count-if (lambda [x] (= x val)) lst))

(define count-not [pred] [lst]
  (count-if (lambda [x] (not (pred x))) lst))

(define count-if-max [pred] [lst] [max-count]
  (let helper [l lst] [n 0]
    (if (>= n max-count)
      n
      (match l
        ()       n
        (h .. t) (if (pred h)
                   (helper t (+ n 1))
                   (helper t n))))))

;; TEST: count-if evens
;; EXPECT: 3
(do (define count-if [pred] [lst] (length (filter pred lst)))
    (count-if (lambda [x] (= (% x 2) 0)) '(1 2 3 4 5 6)))

;; TEST: count-if all
;; EXPECT: 5
(do (define count-if [pred] [lst] (length (filter pred lst)))
    (count-if (lambda [x] (> x 0)) '(1 2 3 4 5)))

;; TEST: count-if none
;; EXPECT: 0
(do (define count-if [pred] [lst] (length (filter pred lst)))
    (count-if (lambda [x] (< x 0)) '(1 2 3 4 5)))

;; TEST: count-if empty
;; EXPECT: 0
(do (define count-if [pred] [lst] (length (filter pred lst)))
    (count-if (lambda [x] true) '()))

;; TEST: count value
;; EXPECT: 3
(do (define count-if [pred] [lst] (length (filter pred lst)))
    (define count [val] [lst] (count-if (lambda [x] (= x val)) lst))
    (count 2 '(1 2 2 3 2 4)))

;; TEST: count not found
;; EXPECT: 0
(do (define count-if [pred] [lst] (length (filter pred lst)))
    (define count [val] [lst] (count-if (lambda [x] (= x val)) lst))
    (count 99 '(1 2 3)))

;; TEST: count in empty
;; EXPECT: 0
(do (define count-if [pred] [lst] (length (filter pred lst)))
    (define count [val] [lst] (count-if (lambda [x] (= x val)) lst))
    (count 1 '()))

;; TEST: count-not evens (count odds)
;; EXPECT: 3
(do (define count-if [pred] [lst] (length (filter pred lst)))
    (define count-not [pred] [lst] (count-if (lambda [x] (not (pred x))) lst))
    (count-not (lambda [x] (= (% x 2) 0)) '(1 2 3 4 5 6)))

;; TEST: count-if-max
;; EXPECT: 3
(do (define count-if-max [pred] [lst] [max-count]
      (let helper [l lst] [n 0]
        (if (>= n max-count)
          n
          (match l
            ()       n
            (h .. t) (if (pred h)
                       (helper t (+ n 1))
                       (helper t n))))))
    (count-if-max (lambda [x] true) '(1 2 3 4 5 6 7 8 9 10) 3))

;; TEST: count-if-max not reached
;; EXPECT: 2
(do (define count-if-max [pred] [lst] [max-count]
      (let helper [l lst] [n 0]
        (if (>= n max-count)
          n
          (match l
            ()       n
            (h .. t) (if (pred h)
                       (helper t (+ n 1))
                       (helper t n))))))
    (count-if-max (lambda [x] (= (% x 2) 0)) '(1 2 3 4) 5))
