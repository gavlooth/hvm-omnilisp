;; test_pattern_nested.lisp - Tests for nested pattern matching

;; Nested list patterns
(define sum-nested [lst]
  (match lst
    ()              0
    ((a b) .. rest) (+ (+ a b) (sum-nested rest))
    (h .. rest)     (+ h (sum-nested rest))))

;; TEST: nested pairs
;; EXPECT: 10
(sum-nested '((1 2) (3 4)))

;; Deep nesting
(define deep-first [x]
  (match x
    (((a .. _) .. _) .. _)  a
    ((a .. _) .. _)         a
    (a .. _)                a
    _                       nothing))

;; TEST: extract deeply nested first element
;; EXPECT: 1
(deep-first '(((1 2) 3) 4))

;; Nested with different structures
(define classify-structure [x]
  (match x
    ((a b) (c d))  "two-pairs"
    ((a b) c)      "pair-and-elem"
    (a (b c))      "elem-and-pair"
    (a b)          "simple-pair"
    _              "other"))

;; TEST: recognize two pairs
;; EXPECT: "two-pairs"
(classify-structure '((1 2) (3 4)))

;; TEST: recognize pair and element
;; EXPECT: "pair-and-elem"
(classify-structure '((1 2) 3))

;; TEST: recognize element and pair
;; EXPECT: "elem-and-pair"
(classify-structure '(1 (2 3)))
