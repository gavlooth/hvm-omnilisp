        -:    0:Source:../hvm4/clang/wnf/dup_lam.c
        -:    0:Graph:main-cov-main.gcno
        -:    0:Data:main-cov-main.gcda
        -:    0:Runs:422
        -:    1:// ! F &L = λx.f
        -:    2:// ---------------- DUP-LAM
        -:    3:// F₀ ← λ$x0.G₀
        -:    4:// F₁ ← λ$x1.G₁
        -:    5:// x  ← &L{$x0,$x1}
        -:    6:// ! G &L = f
    48434:    7:fn Term wnf_dup_lam(u32 lab, u32 loc, u8 side, Term lam) {
    48434:    8:  ITRS++;
    48434:    9:  u32  lam_loc        = term_val(lam);
    48434:   10:  u32  lam_ext        = term_ext(lam);
    48434:   11:  Term bod            = heap_read(lam_loc);
        -:   12:
    48434:   13:  if (lam_ext & LAM_ERA_MASK) {
    13138:   14:    u64  a      = heap_alloc(3);
    13138:   15:    heap_write(a + 2, bod);
    13138:   16:    Copy B      = term_clone_at(a + 2, lab);
    13138:   17:    heap_write(a + 0, B.k0);
    13138:   18:    heap_write(a + 1, B.k1);
    13138:   19:    Term l0     = term_new(0, LAM, lam_ext, a + 0);
    13138:   20:    Term l1     = term_new(0, LAM, lam_ext, a + 1);
    13138:   21:    return heap_subst_cop(side, loc, l0, l1);
        -:   22:  }
        -:   23:
    35296:   24:  u64  a       = heap_alloc(5);
    35296:   25:  heap_write(a + 4, bod);
    35296:   26:  Copy B       = term_clone_at(a + 4, lab);
    35296:   27:  heap_write(a + 0, B.k0);
    35296:   28:  heap_write(a + 1, B.k1);
    35296:   29:  heap_write(a + 2, term_new(0, VAR, 0, a + 0));
    35296:   30:  heap_write(a + 3, term_new(0, VAR, 0, a + 1));
    35296:   31:  Term su      = term_new(0, SUP, lab, a + 2);
    35296:   32:  Term l0      = term_new(0, LAM, lam_ext, a + 0);
    35296:   33:  Term l1      = term_new(0, LAM, lam_ext, a + 1);
    35296:   34:  heap_subst_var(lam_loc, su);
    35296:   35:  return heap_subst_cop(side, loc, l0, l1);
        -:   36:}
